# DaVinci Resolve Integration Setup Guide

## üé¨ Overview

Your image generator app now includes **automatic DaVinci Resolve integration** to place your generated images on the timeline at specific timestamps!

## üìã Prerequisites

1. **DaVinci Resolve Studio** (Free version doesn't have API access)
2. **Python 3.7+** installed on Windows
3. **Your CSV file** with NR and Timestamp columns (generated by Claude)
4. **Your images** named like `001_xxx.png`, `002_xxx.png`, etc.

## üöÄ One-Time Setup

### Step 1: Install Python Dependencies

**Option A: Easy Installer (Recommended)**

Just double-click: `image-generator-app\bridge\install_dependencies.bat`

**Option B: Manual Install**

Open PowerShell in the project folder and run:

```powershell
cd image-generator-app\bridge
pip install -r requirements.txt
```

This installs Flask and Flask-CORS for the bridge server.

### Step 1.5: Verify Setup (Optional but Recommended)

Run the setup checker to make sure everything is configured correctly:

Double-click: `image-generator-app\bridge\check_setup.bat`

Or manually:
```powershell
cd image-generator-app\bridge
python check_setup.py
```

This will check:
- ‚úì Python version
- ‚úì Flask and Flask-CORS installed
- ‚úì DaVinci Resolve API available
- ‚úì Connection to DaVinci Resolve

### Step 2: Enable External Scripting in DaVinci Resolve

1. Open **DaVinci Resolve**
2. Go to **Preferences** (Ctrl+,)
3. Navigate to **General** tab
4. Find **External scripting using**
5. Set it to **Local**
6. Click **Save**

That's it! Setup complete.

## üìñ How to Use

### Step 1: Open Your Next.js App

```powershell
cd image-generator-app
npm run dev
```

Navigate to http://localhost:3000

### Step 2: Click "DaVinci Export" in Header

The bridge server will **automatically start** in the background!

### Step 3: Follow the Wizard

1. **Upload CSV** - Your CSV with NR and Timestamp columns
2. **Select Image Folder** - Browse or paste path to your images folder
3. **Review Mappings** - Tool automatically matches images by number (001_, 002_)
4. **Configure Settings** - Set FPS and video track
5. **Click "Place Images"** - Images are placed automatically!

## üìä CSV Format

Your CSV should look like this:

```csv
NR,Timestamp
1,00:00-00:06
2,00:06-00:10
3,00:10-00:14
...
```

The tool matches by NR to find images like:
- NR 1 ‚Üí `001_ca89f8e9e9be4745bc53bab22eac55e0.png`
- NR 2 ‚Üí `002_810610074a8644cb9697321402f16175.png`
- etc.

## üîß Troubleshooting

### Quick Diagnostic

**First, run the setup checker:**
```powershell
cd image-generator-app\bridge
python check_setup.py
```

This will tell you exactly what's wrong!

### Bridge Won't Start

**Problem:** "Bridge server failed to start"

**Step-by-step solutions:**

1. **Check Python is installed:**
   ```powershell
   python --version
   ```
   Should show: `Python 3.7.0` or higher
   
   If not found, install from: https://www.python.org/downloads/
   ‚ö†Ô∏è **IMPORTANT:** Check "Add Python to PATH" during installation!

2. **Install dependencies:**
   ```powershell
   cd image-generator-app\bridge
   pip install -r requirements.txt
   ```
   
   Or double-click: `install_dependencies.bat`

3. **Test the bridge manually:**
   ```powershell
   cd image-generator-app\bridge
   python davinci_bridge.py
   ```
   
   You should see:
   ```
   üé¨ DaVinci Resolve Bridge Server
   Status: Running on http://localhost:8765
   ```
   
   If you see errors, they'll tell you what's wrong!

4. **Check the Next.js console:**
   - Open your browser's Developer Tools (F12)
   - Check the Console tab for error messages
   - Look for `[Bridge]` or `[Bridge Error]` messages

### Can't Connect to DaVinci Resolve

**Problem:** "DaVinci Resolve: Not Connected"

**Solutions:**
1. Make sure DaVinci Resolve is **running**
2. Open a **project**
3. Open/select a **timeline**
4. Check external scripting is enabled (see Setup Step 2)

### Images Not Found

**Problem:** "Some images missing"

**Solutions:**
1. Check folder path is correct
2. Verify images are named like `001_*.png`, `002_*.png`, etc.
3. Check file extensions (`.png`, `.jpg`, `.jpeg`, `.webp` supported)
4. Make sure NR numbers in CSV match image prefixes

### Python Import Error

**Problem:** "DaVinci Resolve API not found"

**Solutions:**
1. Install DaVinci Resolve Studio (not free version)
2. Check path: `C:\ProgramData\Blackmagic Design\DaVinci Resolve\Support\Developer\Scripting`
3. Restart DaVinci Resolve with external scripting enabled

## üéØ Tips

- **Save Time:** The tool remembers your last used image folder
- **Batch Process:** You can process hundreds of images at once
- **Validation:** Always check the preview table before placing
- **Track Selection:** Use Track 2 to keep your main footage on Track 1
- **Undo:** You can undo in DaVinci if placement isn't right (Ctrl+Z)

## üìù Workflow Example

1. Generate images using Claude + your script
2. Claude outputs CSV with accurate timestamps from SRT
3. Export images to a folder (001_xxx.png, 002_xxx.png, etc.)
4. Open Next.js app ‚Üí DaVinci Export
5. Upload CSV, select folder
6. Click "Place Images"
7. Done! All images placed at correct timestamps

## üêõ Known Issues

- **First run may be slow:** Bridge server takes 2-3 seconds to start
- **Windows Defender:** May ask permission for Python server
- **Large batches:** 100+ images may take a minute to import

## üí° Advanced

### Manual Bridge Control

If you want to control the bridge manually:

```powershell
# Start bridge
python bridge/davinci_bridge.py

# Stop bridge
# Just close the terminal window or press Ctrl+C
```

### Custom Port

Bridge runs on port 8765 by default. To change:

Edit `bridge/davinci_bridge.py` line 353:
```python
app.run(host='localhost', port=8765, debug=False)
```

## üÜò Support

If you encounter issues:

1. Check this guide first
2. Look at bridge server output for errors
3. Check DaVinci Resolve's console for API errors
4. Make sure all prerequisites are met

## üéâ Success!

Once set up, you'll be able to place hundreds of images on your timeline in seconds instead of manually dragging each one!

